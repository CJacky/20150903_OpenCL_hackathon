#!/bin/bash

# one should modify this part
#ROOTDIR=/home/user/20150903...
#CLINC=-I/opt/intel/opencl-sdk/include/
#CLLIB="-L/opt/intel/opencl-sdk/lib64/ -lOpenCL"
#CLPRELOAD="LD_PRELOAD=/opt/intel/opencl-sdk/lib64/libOpenCL.so"

if [ $1"y" == "1y" ]; then
	cd $ROOTDIR/good_matvec
	gcc matvec.c $CLINC $CLLIB 2> /dev/null
	$CLPRELOAD ./a.out
elif [ $1"y" == "2y" ]; then
	cd $ROOTDIR/good_matvec
	# root should start corresponding server first in this demo
	../socket/client 192.168.0.102 $2
elif [ $1"y" == "3y" ]; then
	cd $ROOTDIR/bad_matvec
	# root should start corresponding server first in this demo
	# and the exploit is shown here
	../socket/client 192.168.0.102 $2
elif [ $1"y" == "4y" ]; then
	# this is not just a vulnerability demo. this works
	# even if server side did check non-permitted calls
	# like system(), exec()
	# and the all functionality is implemented during the hackathon
	diff $ROOTFIR/good_matvec/matvec.c $ROOTDIR/bad_matvec/matvec.c
fi
